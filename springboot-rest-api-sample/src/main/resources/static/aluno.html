<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="ISO-8859-1">

<title>Aluno</title>

<script src="https://code.jquery.com/jquery-3.6.0.js"
	integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
	integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
	crossorigin="anonymous"></script>

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
	crossorigin="anonymous">

</head>
<body>


	<div id="divHeader"></div>

	<form action="" id="formCadastroUser">

		<div class="mb-3">
			<label for="id" class="form-label">ID</label> <input type="text" class="form-control" id="id"
				readonly="readonly">
		</div>

		<div class="mb-3">


			<label for="Nome" class="form-label">Informe o RA do Aluno</label> <input type="text"
				class="form-control" id="rah" placeholder="Infrome ra do aluno " required="required"> <label
				for="date" class="col-1 col-form-label">Date</label>
			<div class="col-5">
				<div class="input-group date" id="datepicker">
					<input type="text" class="form-control" id="date" /> <span class="input-group-append">
						<span class="input-group-text bg-light d-block"> <i class="fa fa-calendar"></i>
					</span>
					</span>
				</div>
			</div>
	</form>

	<div class="mb-3">
		<label for="status">Informe o Status:</label> <select name="status" id="status">
			<option value="1">Ativo</option>
			<option value="2">Desativado</option>
			<option value="3">Não Identificado</option>
			<option value="4">Temporariamente Fora</option>
		</select> <br> <br>
	</div>
	<label for="cars">Escolha o seu Estado Civil</label>
	<select name="cars" id="cmbEstadoCivil">

		<option value=""></option>


	</select>

	<br>
	<br>


	<button type="button" class="btn btn-primary" onclick="salvarAltura()">Salvar</button>


	<button type="button" class="btn btn-secondary"
		onclick="document.getElementById('formCadastroUser').reset();">Novo</button>


	<button type="button" class="btn btn-danger" data-bs-toggle="modal"
		data-bs-target="#modalbuscarPorStatus">Pesquisar</button>



	<button type="button" class="btn btn-warning" onclick="botaodeletarDaTela()">Deletar</button>

	<div class="container">
		<div class="row">
			<div class="col-12">



				<div class="modal fade" id="modalbuscarPorStatus" tabindex="-1"
					aria-labelledby="exampleModalLabel" aria-hidden="true">


					<div class="modal-dialog">


						<div class="modal-content">


							<div class="modal-header">


								<h5 class="modal-title" id="exampleModalLabel">Pesquisa de Categoria</h5>


								<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>


							</div>



							<div class="modal-body">
								<form>
									<div class="mb-3">
										<label for="recipient-name" class="col-form-label"> Informe o Status: </label> <input
											type="text" class="form-control" id="statusBusca">
									</div>


									<div class="mb-3"></div>
									<button type="button" class="btn btn-success" onclick="getListAltura()">Buscar</button>

								</form>

								<div style="height: 300px; overflow: scroll;">
									<table class="table" id="tabelaResultados">
										<thead>
											<tr>
												<th scope="col">ID</th>
												<th scope="col">ra</th>
												<th scope="col">Nascimento</th>
												<th scope="col">Estado Civil</th>
												<th scope="col">Editar</th>
												<th scope="col">Deletar</th>

											</tr>
										</thead>
										<tbody>

										</tbody>
									</table>
								</div>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
							</div>
						</div>
					</div>
				</div>






				<script type="text/javascript">
					function salvarAltura() {

						var id         = $('#id').val();

						var ra         = $('#rah').val();

						var nasc       = $('#date').val();
						
						var estadoCivil = $("#cmbEstadoCivil").val();

						
						console.log(
								
								{
									idAluno : id,
									ra : ra,
									dataNasc : new Date($('#date').val()),
									idEstadoCivil : estadoCivil
								}
								);

						new Date()
						$.ajax({
							method : "POST",
							contentType : "application/json; charset= utf-8",
							url : "aluno",
							data : JSON.stringify(
							{
								idAluno : id,
								ra : ra,
								dataNasc : new Date($('#date').val()),
								idEstadoCivil : estadoCivil
							}),
							success : function(response) {

								$("#id").val(response.id);
								alert("salvou com sucesso");
							}

						}).fail(function(xhr, status, errorThrown) {
							alert("Erro ao salvar" + xhr.reponseText);
						})
					}

					function getListAltura() {
						$
								.ajax(
										{
											method : "GET",
											url : "aluno",
																
											
											success : function(response) {

												$(
														'#tabelaResultados > tbody > tr')
														.remove();

												for (var i = 0; i < response.length; i++) {

													$(
															'#tabelaResultados > tbody')
															.append(
																	'<tr id="'+response[i].idAluno+'"><td>'
																			+ response[i].idAluno
																			+ '</td><td>'
																			+ response[i].ra
																			+ '</td><td>'
																			+ response[i].dataNasc
																			+ '</td><td>'
																			+ response[i].idEstadoCivil
																			+ '</td> <td><button type="button" onclick = "colocarEmEdicao('
																			+ response[i].idAluno
																			+ ')" class="btn btn-primary">Ver</button></td><td><button type="button" class="btn btn-danger" onclick = "deleteUser('
																			+ response[i].idAluno
																			+ ')">Deletar</button></td><td></tr>');
												}
											}
										}).fail(
										function(xhr, status, errorThrown) {
											alert("Erro ao Buscar Usuário"
													+ xhr.reponseText);
										})
					}

					function colocarEmEdicao(id) {
						$.ajax({
							method : "GET",
							url : "aluno/id",
							data : "id=" + id,

							success : function(response) {

								$("#id").val(response.idAluno);

								$("#rah").val(response.ra);

								$('#date').val(response.dataNasc);
			
								$('#cmbEstadoCivil').val(response.idEstadoCivil);
								
								$('#modalbuscarPorStatus').modal('hide');

							}

						}).fail(
								function(xhr, status, errorThrown) {
									alert("Erro ao Buscar Usuário por id: "
											+ xhr.reponseText);

								})
					}

					function deleteUser(id) {
						if (confirm('Deseja realemente deletar ?')) {
							$
									.ajax({
										method : "DELETE",
										url : "aluno",
										data : "id=" + id,

										success : function(response) {

											$('#' + id).remove();

											alert(response);

										}

									})
									.fail(
											function(xhr, status, errorThrown) {
												alert("Erro ao deletar o Usuário por ID: "
														+ xhr.reponseText);

											})
						}

					}

					jQuery(document).ready(function() {
						getListEstado();

						jQuery('.toggle-nav').click(function(e) {
							jQuery(this).toggleClass('active');
							jQuery('.menu ul').toggleClass('active');
							e.preventDefault();

						});

						$("#divHeader").load("header.html");

					});
					$('#datepicker').datepicker();

					$('#datepicker').datepicker({
						defaultDate : "08/02/2016",
						locale : 'pt-br'
					});
				</script>

				<style>
.input-group-append {
	cursor: pointer;
}
</style>
</body>
</html>